# 📢 自动更新云公告功能

## 功能说明

这个功能可以自动将每次代码更新添加到 GitHub Gist 云公告中，用户打开网站时就能看到更新内容。

## 使用方法

### 方法 1：手动运行脚本（推荐）

```bash
# 使用最新的 commit 信息更新公告
node update-announcement.js

# 或者使用自定义消息
node update-announcement.js "新增了自定义格式选择功能"
```

### 方法 2：自动更新（提交后自动运行）

1. **设置 GitHub Token**
   - 访问：https://github.com/settings/tokens
   - 点击 "Generate new token (classic)"
   - 勾选 `gist` 权限
   - 生成后复制 token

2. **设置环境变量**

   **Windows (PowerShell):**
   ```powershell
   $env:GITHUB_TOKEN="your_token_here"
   ```

   **Windows (CMD):**
   ```cmd
   set GITHUB_TOKEN=your_token_here
   ```

   **Linux/Mac:**
   ```bash
   export GITHUB_TOKEN=your_token_here
   ```

   或者添加到系统环境变量（永久设置）

3. **启用 Git Hook（可选）**
   ```bash
   # Windows 需要先安装 Git Bash
   chmod +x .git/hooks/post-commit
   ```

   之后每次 `git commit` 后会自动更新公告。

## 公告格式

公告会以 JSON 格式存储在 GitHub Gist 中：

```json
{
  "id": "时间戳",
  "title": "公告通知",
  "message": "公告内容（支持 Markdown）",
  "date": "2025-01-04",
  "isActive": true,
  "history": [
    "• 2025年1月4日 14:30 - 新增了自定义格式选择功能",
    "• 2025年1月4日 10:15 - 修复了背景图切换问题"
  ]
}
```

## 公告内容示例

脚本会自动生成如下格式的公告：

```markdown
## 📢 最新更新

• 2025年1月4日 14:30 - 新增了自定义格式选择功能

## 📜 更新历史

• 2025年1月4日 14:30 - 新增了自定义格式选择功能
• 2025年1月4日 10:15 - 修复了背景图切换问题
• 2025年1月3日 16:20 - 优化了下载速度
```

## 注意事项

1. **Token 安全**：不要将 `GITHUB_TOKEN` 提交到代码仓库
2. **权限要求**：Token 需要有 `gist` 权限
3. **Gist ID**：确保 `update-announcement.js` 中的 `gistId` 与前端配置一致
4. **历史记录**：自动保留最近 20 条更新记录

## 测试

```bash
# 测试更新（使用自定义消息）
node update-announcement.js "测试更新功能"

# 检查 Gist 是否更新成功
# 访问：https://gist.github.com/1662187689/ae97ddcecaaf2f3dea622ef7b2520c67
```

## 故障排查

1. **Token 未设置**
   ```
   ❌ 错误: 需要设置 GITHUB_TOKEN 环境变量
   ```
   解决：按照上面的步骤设置环境变量

2. **权限不足**
   ```
   ❌ 更新失败: 403
   ```
   解决：确保 Token 有 `gist` 权限

3. **Gist 不存在**
   ```
   ❌ 获取 Gist 失败: 404
   ```
   解决：检查 `gistId` 是否正确

