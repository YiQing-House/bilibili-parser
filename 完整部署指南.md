# 🚀 B站视频解析助手 - 完整部署指南

> **最详细的部署教程，从零到上线，一步不漏！**

---

## 📋 目录

1. [准备工作](#准备工作)
2. [本地开发环境搭建](#本地开发环境搭建)
3. [GitHub 代码管理](#github-代码管理)
4. [Render 云部署](#render-云部署)
5. [腾讯云域名配置](#腾讯云域名配置)
6. [SSL 证书配置](#ssl-证书配置)
7. [部署后验证](#部署后验证)
8. [常见问题排查](#常见问题排查)

---

## 📦 准备工作

### 1. 必需工具

- ✅ **Git** - 代码版本控制
  - 下载：https://git-scm.com/download/win
  - 安装时选择默认选项

- ✅ **Node.js** - 运行后端
  - 下载：https://nodejs.org/（推荐 LTS 版本）
  - 验证：`node --version` 和 `npm --version`

- ✅ **GitHub 账号** - 代码托管
  - 注册：https://github.com/

- ✅ **Render 账号** - 云服务器
  - 注册：https://render.com/（可用 GitHub 账号登录）

- ✅ **腾讯云账号** - 域名管理（可选）
  - 注册：https://cloud.tencent.com/

### 2. 项目文件检查

确保项目包含以下文件：

```
.
├── server.js                    # 后端服务器（必需）
├── package.json                 # Node.js 依赖（必需）
├── Dockerfile                   # Docker 配置（必需）
├── requirements.txt             # Python 依赖（必需）
├── services/                    # 服务模块（必需）
│   ├── bilibiliService.js
│   ├── multiPlatformService.js
│   ├── videoParser.js
│   └── ytdlpService.js
└── public/                      # 前端文件（必需）
    ├── index.html
    ├── script.js
    └── styles.css
```

---

## 💻 本地开发环境搭建

### 步骤 1：安装依赖

**Windows 用户（推荐）**：
```bash
# 双击运行
安装依赖-本地.bat
```

**手动安装**：
```bash
# 安装 Node.js 依赖
npm install

# 安装 Python 依赖（yt-dlp）
pip install yt-dlp

# 安装 ffmpeg（Windows）
# 下载：https://ffmpeg.org/download.html
# 或使用 Chocolatey: choco install ffmpeg
```

### 步骤 2：启动服务器

**Windows 用户（推荐）**：
```bash
# 双击运行
启动应用.bat
```

**手动启动**：
```bash
npm start
```

### 步骤 3：访问应用

打开浏览器访问：`http://localhost:3000`

### 步骤 4：测试功能

1. **解析视频**：输入 B站视频链接，点击"解析下载"
2. **测试下载**：选择画质和格式，点击下载
3. **测试批量**：输入多个链接（换行分隔）
4. **测试收藏夹**：输入收藏夹链接或 ID

---

## 📤 GitHub 代码管理

### 步骤 1：配置 Git（首次使用）

```bash
# 设置用户名
git config --global user.name "你的GitHub用户名"

# 设置邮箱（使用GitHub注册邮箱）
git config --global user.email "你的邮箱@example.com"

# 验证配置
git config --list
```

### 步骤 2：初始化 Git 仓库

在项目根目录运行：

```bash
# 初始化仓库
git init

# 查看状态
git status
```

### 步骤 3：创建 GitHub 仓库

1. **登录 GitHub**
   - 访问：https://github.com/
   - 登录你的账号

2. **创建新仓库**
   - 点击右上角 `+` → `New repository`
   - **Repository name**: `bilibili-parser`（自定义）
   - **Description**: `B站视频解析助手`
   - **Visibility**: 
     - `Public`（公开，免费）
     - `Private`（私有，需要付费）
   - **不要勾选任何选项**（README、.gitignore、License）
   - 点击 `Create repository`

3. **复制仓库地址**
   - 创建后会显示仓库地址
   - 类似：`https://github.com/你的用户名/bilibili-parser.git`

### 步骤 4：添加并提交代码

```bash
# 添加所有文件（.gitignore 会自动排除不需要的文件）
git add .

# 查看将要提交的文件
git status

# 创建首次提交
git commit -m "Initial commit: B站视频解析助手"
```

### 步骤 5：连接并推送到 GitHub

```bash
# 添加远程仓库（替换为你的仓库地址）
git remote add origin https://github.com/你的用户名/bilibili-parser.git

# 验证远程仓库
git remote -v

# 推送到 GitHub
git push -u origin main
```

**如果遇到分支名错误**：
```bash
# 检查当前分支
git branch

# 如果显示 master，重命名为 main
git branch -M main

# 或直接推送到 master
git push -u origin master
```

### 步骤 6：GitHub 认证（重要！）

GitHub 现在使用**个人访问令牌**而不是密码：

1. **生成令牌**
   - 访问：https://github.com/settings/tokens
   - 点击 `Generate new token` → `Generate new token (classic)`
   - **Note**: `Git Push Token`
   - **Expiration**: `90 days`
   - **勾选权限**：✅ `repo`（完整仓库权限）
   - 点击 `Generate token`
   - **⚠️ 重要**：复制令牌（只显示一次！）

2. **使用令牌推送**
   ```bash
   git push -u origin main
   ```
   - Username: 你的 GitHub 用户名
   - Password: **粘贴刚才复制的令牌**（不是密码！）

### 步骤 7：后续更新代码

修改代码后，推送更新：

```bash
# 1. 查看修改
git status

# 2. 添加修改的文件
git add .

# 3. 提交修改
git commit -m "更新：描述你的修改"

# 4. 推送到 GitHub
git push
```

---

## ☁️ Render 云部署

### 步骤 1：登录 Render

1. 访问：https://render.com/
2. 点击 `Get Started for Free`
3. 使用 GitHub 账号登录（推荐）

### 步骤 2：创建 Web Service

1. **点击 "New +" → "Web Service"**

2. **连接 GitHub 仓库**
   - 点击 `Connect account`（如果还没连接）
   - 选择你的 GitHub 账号
   - 授权 Render 访问仓库
   - 选择仓库：`bilibili-parser`

3. **配置服务**
   - **Name**: `bilibili-parser`（自定义，会出现在 URL 中）
   - **Region**: `Singapore`（离中国最近）
   - **Branch**: `main`（或 `master`，根据你的仓库）
   - **Root Directory**: 留空（项目在根目录）
   - **Environment**: **选择 `Docker`** ⚠️ 重要！
   - **Dockerfile Path**: 留空（默认使用根目录的 Dockerfile）
   - **Docker Context**: 留空

4. **环境变量（可选）**
   - 点击 `Advanced` → `Add Environment Variable`
   - `NODE_ENV`: `production`
   - `PORT`: Render 会自动设置，无需手动配置

5. **点击 "Create Web Service"**
   - Render 会自动开始构建
   - 等待 5-10 分钟完成部署

### 步骤 3：查看部署状态

1. **查看构建日志**
   - 在服务页面点击 `Logs` 标签
   - 查看构建进度和错误信息

2. **等待部署完成**
   - 状态从 `Building` → `Live`
   - 获得 Render 提供的 URL：`https://your-app.onrender.com`

### 步骤 4：验证部署

1. **访问应用**
   - 打开 Render 提供的 URL
   - 应该能看到应用界面

2. **测试功能**
   - 解析一个视频链接
   - 测试下载功能
   - 检查控制台是否有错误

---

## 🌐 腾讯云域名配置

### 步骤 1：登录腾讯云控制台

1. 访问：https://console.cloud.tencent.com/
2. 登录你的账号
3. 确保域名已实名认证

### 步骤 2：进入域名解析

1. 搜索 "域名注册" 或 "DNS解析 DNSPod"
2. 找到你的域名
3. 点击 "解析"

### 步骤 3：添加解析记录

点击 "添加记录"，配置如下：

| 参数 | 值 | 说明 |
|------|-----|------|
| **主机记录** | `@` | 主域名（如 `example.com`） |
| **记录类型** | `CNAME` | 使用 CNAME（推荐） |
| **线路类型** | `默认` | 或选择特定线路 |
| **记录值** | `your-app.onrender.com` | Render 提供的域名（去掉 `https://`） |
| **TTL** | `600` | 或使用默认值 |

**示例配置**：
```
主机记录: @
记录类型: CNAME
记录值: bilibili-parser.onrender.com
TTL: 600
```

**如果同时配置 www 子域名**：
```
主机记录: www
记录类型: CNAME
记录值: bilibili-parser.onrender.com
TTL: 600
```

### 步骤 4：保存并等待生效

1. 点击 "保存"
2. DNS 解析通常 **5-30 分钟**生效
3. 可以通过 `ping 你的域名.com` 检查是否生效

### 步骤 5：在 Render 添加自定义域名

1. **进入 Render 服务设置**
   - 进入你的服务页面
   - 点击 `Settings` → `Custom Domains`

2. **添加域名**
   - 点击 `Add Custom Domain`
   - 输入你的域名：`你的域名.com`
   - 点击 `Save`

3. **添加 www 子域名（可选）**
   - 再次点击 `Add Custom Domain`
   - 输入：`www.你的域名.com`
   - 点击 `Save`

---

## 🔒 SSL 证书配置

### 方案 A：使用 Render 的免费 SSL（⭐ 推荐）

Render 自动为自定义域名提供免费 SSL 证书！

1. **等待自动配置**
   - 添加自定义域名后，Render 会自动申请 Let's Encrypt 证书
   - 通常需要 **5-10 分钟**

2. **验证配置**
   - 访问 `https://你的域名.com`
   - 浏览器应该显示绿色锁图标 🔒
   - URL 显示 `https://` 而不是 `http://`

3. **强制 HTTPS（可选）**
   - 在 Render Settings → Custom Domains
   - 启用 `Force HTTPS`

### 方案 B：使用腾讯云 SSL 证书（备选）

如果 Render 不支持自动 SSL，可以使用腾讯云证书：

1. **申请免费 SSL 证书**
   - 访问：https://console.cloud.tencent.com/ssl
   - 点击 "申请免费证书"
   - 选择 "域名型免费证书（DV）"
   - 填写域名信息
   - 验证域名所有权（DNS 验证或文件验证）
   - 等待审核（通常几分钟）

2. **下载证书**
   - 审核通过后，下载证书文件
   - 包含 `.crt` 和 `.key` 文件

3. **在 Render 配置证书**
   - 进入服务 Settings
   - 找到 SSL 证书配置
   - 上传证书文件

---

## ✅ 部署后验证

### 1. 检查域名解析

在命令行运行：

```bash
# Windows
ping 你的域名.com

# 或使用 nslookup
nslookup 你的域名.com
```

应该看到指向 Render 服务器的 IP 或域名。

### 2. 检查 HTTPS

访问 `https://你的域名.com`，应该：
- ✅ 显示绿色锁图标
- ✅ 没有 "不安全" 警告
- ✅ URL 显示 `https://`

### 3. 测试功能

1. **访问你的网站**
   - 打开 `https://你的域名.com`

2. **测试解析功能**
   - 输入一个 B站视频链接
   - 点击"解析下载"
   - 检查是否能正常解析

3. **测试下载功能**
   - 选择画质和格式
   - 点击下载
   - 检查是否能正常下载

4. **测试批量解析**
   - 输入多个链接（换行分隔）
   - 检查是否能批量解析

5. **测试收藏夹解析**
   - 输入收藏夹链接或 ID
   - 检查是否能解析收藏夹

### 4. 检查控制台

打开浏览器开发者工具（F12）：
- 检查 Console 是否有错误
- 检查 Network 请求是否正常
- 检查是否有 CORS 错误

---

## 🔧 常见问题排查

### 问题 1：GitHub 推送失败

**错误信息**：`fatal: remote origin already exists`

**解决方法**：
```bash
# 删除旧的远程仓库
git remote remove origin

# 重新添加
git remote add origin https://github.com/你的用户名/bilibili-parser.git
```

**错误信息**：认证失败

**解决方法**：
- 使用个人访问令牌（见上方 GitHub 认证部分）
- 或使用 GitHub Desktop（图形界面）

### 问题 2：Render 部署失败

**错误信息**：Dockerfile 构建失败

**检查清单**：
- [ ] Dockerfile 是否在项目根目录
- [ ] Dockerfile 语法是否正确
- [ ] 查看 Render Logs 中的具体错误

**解决方法**：
1. 检查 Dockerfile 内容
2. 确认所有文件都已推送到 GitHub
3. 查看构建日志中的错误信息

**错误信息**：服务无法启动

**检查清单**：
- [ ] server.js 是否使用 `process.env.PORT || 3000`
- [ ] 查看 Render Logs 中的错误信息

**解决方法**：
1. 检查 server.js 端口配置
2. 查看日志中的具体错误
3. 确认环境变量配置正确

### 问题 3：域名无法访问

**检查清单**：
- [ ] DNS 解析是否生效（等待 30 分钟）
- [ ] 解析记录是否正确（CNAME 值是否正确）
- [ ] Render 服务是否正常运行
- [ ] 是否在 Render 中添加了自定义域名

**解决方法**：
```bash
# 检查 DNS 解析
nslookup 你的域名.com

# 检查 Render 服务状态
# 在 Render 控制台查看服务状态
```

### 问题 4：HTTPS 不工作

**可能原因**：
- SSL 证书未配置
- DNS 解析未生效
- Render 证书申请失败

**解决方法**：
1. 确认在 Render 中添加了自定义域名
2. 等待 10-15 分钟让证书生效
3. 清除浏览器缓存
4. 检查 Render Logs 中的 SSL 错误

### 问题 5：网站显示 Render 默认页面

**原因**：域名解析指向错误

**解决方法**：
1. 检查 CNAME 记录值是否为正确的 Render 域名
2. 确认 Render 服务已添加自定义域名
3. 等待 DNS 解析生效

### 问题 6：部分功能不工作

**可能原因**：
- API 地址配置错误
- CORS 问题
- 服务器错误

**解决方法**：
1. 检查浏览器控制台错误
2. 确认 `API_BASE_URL` 配置正确（应该使用 `window.location.origin`）
3. 检查 Render Logs
4. 测试 API 端点是否正常

---

## 📊 完整配置检查清单

### 部署前检查

- [ ] Git 已安装并配置
- [ ] Node.js 已安装
- [ ] 代码已推送到 GitHub
- [ ] GitHub 仓库已创建
- [ ] Render 账号已创建
- [ ] Render 服务已创建
- [ ] Environment 选择 `Docker`
- [ ] 服务部署成功（状态为 Live）

### 域名配置检查

- [ ] 腾讯云域名已实名认证
- [ ] DNS 解析记录已添加
- [ ] 在 Render 添加了自定义域名
- [ ] DNS 解析已生效（等待 30 分钟）
- [ ] SSL 证书已配置（自动或手动）
- [ ] HTTPS 访问正常

### 功能验证检查

- [ ] 网站可以正常访问
- [ ] 单链接解析功能正常
- [ ] 批量解析功能正常
- [ ] 收藏夹解析功能正常
- [ ] 下载功能正常
- [ ] 主题切换功能正常
- [ ] 登录功能正常（如果使用）

---

## 🎯 推荐配置总结

### 最佳实践

1. **使用 Dockerfile 部署**
   - Environment 选择 `Docker`
   - 自动包含所有依赖（yt-dlp、ffmpeg）

2. **同时配置主域名和 www**
   - `你的域名.com` → Render
   - `www.你的域名.com` → Render

3. **使用 CNAME 记录**
   - 更灵活，IP 变更时无需修改

4. **启用 HTTPS**
   - 使用 Render 自动 SSL（最简单）
   - 或使用腾讯云免费证书

5. **设置合理的 TTL**
   - 生产环境：600（10分钟）
   - 测试环境：60（1分钟）

---

## 📚 相关资源

- [Git 官方文档](https://git-scm.com/doc)
- [GitHub 帮助文档](https://docs.github.com/)
- [Render 文档](https://render.com/docs)
- [Docker 文档](https://docs.docker.com/)
- [腾讯云域名解析文档](https://cloud.tencent.com/document/product/302)
- [Let's Encrypt 证书](https://letsencrypt.org/)

---

## 💡 提示

1. **首次部署可能需要 10-15 分钟**
   - Docker 镜像构建：5-10 分钟
   - DNS 解析生效：5-30 分钟
   - SSL 证书申请：5-10 分钟

2. **免费计划有资源限制**
   - Render 免费计划：长时间不活动会休眠
   - 首次访问会唤醒（需要等待 30-60 秒）

3. **定期查看日志**
   - Render Logs：检查服务状态
   - 浏览器控制台：检查前端错误

4. **备份代码**
   - 定期推送到 GitHub
   - 重要修改前创建分支

---

**部署完成后，你的应用就可以通过自定义域名访问了！** 🎉

如有问题，请按顺序检查：
1. Render Logs
2. 浏览器控制台
3. DNS 解析状态
4. SSL 证书状态

